<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attack System Fix Test</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #000;
            font-family: 'Courier New', monospace;
            overflow: hidden;
            color: white;
        }
        
        #gameContainer {
            position: relative;
            width: 100vw;
            height: 100vh;
        }
        
        #gameCanvas {
            display: block;
            cursor: crosshair;
        }
        
        #fixPanel {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.9);
            padding: 20px;
            border-radius: 10px;
            z-index: 1000;
            max-width: 400px;
            border: 3px solid #FF5722;
            box-shadow: 0 0 20px rgba(255, 87, 34, 0.5);
        }
        
        #loadingScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #D32F2F, #F44336);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .status-pass { color: #4CAF50; }
        .status-fail { color: #F44336; }
        .status-pending { color: #FF9800; }
        
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas"></canvas>
        
        <div id="fixPanel">
            <h2>🔧 Attack System Fix Test</h2>
            
            <div style="margin-bottom: 15px; padding: 10px; border-left: 3px solid #FF5722; background: rgba(255, 87, 34, 0.1);">
                <div style="color: #FF5722; font-weight: bold; margin-bottom: 5px;">🎯 Attack System Status</div>
                <div id="attackStatus" class="status-pending">Testing attack functionality...</div>
            </div>
            
            <div style="margin-bottom: 15px; padding: 10px; border-left: 3px solid #2196F3; background: rgba(33, 150, 243, 0.1);">
                <div style="color: #2196F3; font-weight: bold; margin-bottom: 5px;">🧪 Test Instructions</div>
                <div style="font-size: 12px;">
                    1. Click to lock mouse pointer<br>
                    2. <strong>Left click to attack</strong><br>
                    3. Wait for enemies to spawn (30s)<br>
                    4. Attack enemies to test damage system
                </div>
            </div>
            
            <div style="margin-bottom: 15px; padding: 10px; border-left: 3px solid #4CAF50; background: rgba(76, 175, 80, 0.1);">
                <div style="color: #4CAF50; font-weight: bold; margin-bottom: 5px;">✅ Expected Results</div>
                <div style="font-size: 12px;">
                    • No console errors on attack<br>
                    • Attack animations play<br>
                    • Enemies take damage<br>
                    • Health bars update<br>
                    • Combat system logs appear
                </div>
            </div>
            
            <div id="errorLog" style="margin-top: 15px; padding: 10px; background: rgba(244, 67, 54, 0.1); border-left: 3px solid #F44336; display: none;">
                <div style="color: #F44336; font-weight: bold; margin-bottom: 5px;">❌ Errors Detected</div>
                <div id="errorText" style="font-size: 11px; font-family: monospace;"></div>
            </div>
        </div>
        
        <div id="loadingScreen">
            <h1>🔧 Attack Fix Loading 🔧</h1>
            <p>Testing combat system fix...</p>
            <div style="margin-top: 20px; font-size: 14px;">
                🎯 CombatSystem.getTargetsInRange method<br>
                ⚔️ Iron Golem attack functionality<br>
                💥 Damage system integration
            </div>
        </div>
    </div>

    <!-- Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <!-- Game Scripts -->
    <script src="src/core/AudioManager.js"></script>
    <script src="src/core/AssetLoader.js"></script>
    <script src="src/core/InputManager.js"></script>
    <script src="src/entities/Entity.js"></script>
    <script src="src/entities/IronGolem.js"></script>
    <script src="src/entities/Enemy.js"></script>
    <script src="src/entities/Resource.js"></script>
    <script src="src/systems/PhysicsSystem.js"></script>
    <script src="src/systems/CombatSystem.js"></script>
    <script src="src/systems/WaveSystem.js"></script>
    <script src="src/systems/ResourceSystem.js"></script>
    <script src="src/world/WorldGenerator.js"></script>
    <script src="src/ui/HUD.js"></script>
    <script src="src/ui/MenuSystem.js"></script>
    <script src="src/utils/MathUtils.js"></script>
    <script src="src/utils/GeometryUtils.js"></script>
    <script src="src/utils/StorageManager.js"></script>
    <script src="src/core/GameEngine.js"></script>
    <script src="src/main.js"></script>

    <script>
        console.log('🔧 Attack System Fix Test - Monitoring for errors');
        
        function updateStatus(status, message) {
            const element = document.getElementById('attackStatus');
            if (element) {
                const icon = status === 'pass' ? '✅' : status === 'fail' ? '❌' : '⏳';
                const className = `status-${status}`;
                element.innerHTML = `${icon} ${message}`;
                element.className = className;
            }
        }
        
        function showError(error) {
            const errorLog = document.getElementById('errorLog');
            const errorText = document.getElementById('errorText');
            if (errorLog && errorText) {
                errorLog.style.display = 'block';
                errorText.textContent = error;
            }
        }
        
        // Monitor for errors
        let errorDetected = false;
        const originalError = console.error;
        console.error = function(...args) {
            originalError.apply(console, args);
            
            const message = args.join(' ');
            if (message.includes('getTargetsInRange') || message.includes('attack')) {
                errorDetected = true;
                updateStatus('fail', 'Attack system error detected!');
                showError(message);
            }
        };
        
        // Monitor for successful attacks
        let attackCount = 0;
        let damageDealt = 0;
        
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, args);
            
            const message = args.join(' ');
            
            if (message.includes('IRON GOLEM ATTACKS')) {
                attackCount++;
                if (!errorDetected) {
                    updateStatus('pass', `Attack system working! ${attackCount} attacks executed`);
                }
            }
            
            if (message.includes('Iron Golem deals') && message.includes('damage')) {
                damageDealt++;
                updateStatus('pass', `Combat working! ${damageDealt} damage instances dealt`);
            }
        };
        
        // Test attack functionality
        setTimeout(() => {
            updateStatus('pending', 'Ready to test - Click to attack!');
        }, 2000);
        
        // Monitor for 30 seconds
        setTimeout(() => {
            if (!errorDetected && attackCount === 0) {
                updateStatus('pending', 'No attacks detected - Try left clicking!');
            }
        }, 30000);
        
        console.log('🧪 Attack fix test initialized - Left click to test attacks!');
    </script>
</body>
</html> 